<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Apura√ß√£o Eleitoral ‚Ä¢ Tempo Real</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
/* --- CONFIGURA√á√ïES GERAIS E VARI√ÅVEIS --- */
:root {
  --verde: #10b981;
  --verde-glow: rgba(16, 185, 129, 0.5);
  --azul: #2563eb;
  --azul-escuro: #1e40af;
  --ouro: #fbbf24;
  --vermelho: #ef4444;
  --vermelho-escuro: #991b1b;
  --bg-body: #f3f4f6;
  --card-bg: #ffffff;
  --texto-principal: #111827;
  --texto-secundario: #6b7280;
  --sombra-suave: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --sombra-forte: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  --gradient-header: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
}

* { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; outline: none; }

body {
  background-color: var(--bg-body);
  color: var(--texto-principal);
  min-height: 100vh;
  padding-bottom: 40px;
}

/* --- HEADER --- */
header {
  background: var(--gradient-header);
  color: white;
  padding: 20px 0;
  box-shadow: var(--sombra-forte);
  position: relative;
  z-index: 10;
}

header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--verde), var(--ouro), var(--verde));
  animation: shimmerBorder 2s infinite linear;
  background-size: 200% 100%;
}

@keyframes shimmerBorder { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }

.container { max-width: 1280px; margin: 0 auto; padding: 0 20px; }

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
}

.logo { display: flex; align-items: center; gap: 15px; }
.logo i { font-size: 2.2rem; color: var(--ouro); filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.4)); }
.logo h1 { font-size: 1.5rem; font-weight: 800; line-height: 1.2; }
.logo p { font-size: 0.85rem; opacity: 0.9; font-weight: 400; letter-spacing: 0.5px; text-transform: uppercase; }

.header-controls { display: flex; gap: 10px; }

.btn {
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
  font-size: 0.9rem;
}

.btn-glass {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-glass:hover { background: rgba(255, 255, 255, 0.25); transform: translateY(-2px); }

.btn-danger {
  background: linear-gradient(135deg, var(--vermelho), var(--vermelho-escuro));
  color: white;
  box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
}

.btn-danger:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6); }

/* --- PAINEL DE STATUS --- */
.status-bar {
  background: white;
  margin-top: -30px;
  border-radius: 16px;
  padding: 20px 30px;
  box-shadow: var(--sombra-forte);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 20px;
  position: relative;
  z-index: 5;
  border: 1px solid rgba(0,0,0,0.05);
}

.status-left { display: flex; flex-direction: column; gap: 5px; }

.badge-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #ecfdf5;
  color: var(--verde);
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 0.9rem;
  width: fit-content;
}

.dot { width: 8px; height: 8px; background: var(--verde); border-radius: 50%; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); animation: pulseDot 1.5s infinite; }

@keyframes pulseDot { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

.sessao-info { color: var(--texto-secundario); font-size: 0.9rem; font-weight: 500; }

.countdown-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #f8fafc;
  padding: 10px 25px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
  transition: all 0.3s;
}

.countdown-box.tenso {
  border-color: var(--vermelho);
  background: #fef2f2;
  animation: tenso 0.8s ease-in-out infinite;
}

.countdown-number { font-size: 2.2rem; font-weight: 900; color: var(--azul); line-height: 1; font-variant-numeric: tabular-nums; }
.countdown-label { font-size: 0.75rem; color: var(--texto-secundario); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-bottom: 4px; }

.stats-grid { display: flex; gap: 30px; text-align: center; }
.stat-item h3 { font-size: 1.2rem; font-weight: 800; color: var(--texto-principal); }
.stat-item p { font-size: 0.8rem; color: var(--texto-secundario); }

/* --- GRID DE APURA√á√ÉO --- */
.main-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.painel {
  background: white;
  border-radius: 20px;
  padding: 25px;
  box-shadow: var(--sombra-suave);
  border: 1px solid rgba(0,0,0,0.05);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
  overflow: hidden;
}

.painel:hover { transform: translateY(-5px); box-shadow: var(--sombra-forte); }

/* Efeito de Flash (Atualiza√ß√£o) */
.painel.flash::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle, rgba(251, 191, 36, 0.2) 0%, transparent 70%);
  animation: flashEffect 0.6s ease-out;
  pointer-events: none;
}
@keyframes flashEffect { from { opacity: 1; } to { opacity: 0; } }

.painel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f3f4f6; padding-bottom: 15px; }
.painel-header h2 { font-size: 1.4rem; color: var(--azul-escuro); font-weight: 800; display: flex; align-items: center; gap: 10px; }
.painel-tag { background: #eff6ff; color: var(--azul); padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; }

.progress-area { margin-bottom: 25px; }
.progress-labels { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--texto-secundario); margin-bottom: 8px; font-weight: 600; }
.bar-bg { height: 12px; background: #e5e7eb; border-radius: 10px; overflow: hidden; }
.bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--azul), var(--verde));
  border-radius: 10px;
  width: 0%;
  transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}
.bar-fill::after {
  content: ''; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
  background: linear-gradient(45deg, rgba(255,255,255,.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.15) 50%, rgba(255,255,255,.15) 75%, transparent 75%, transparent);
  background-size: 1rem 1rem;
  animation: stripemove 1s linear infinite;
}
@keyframes stripemove { from { background-position: 0 0; } to { background-position: 1rem 1rem; } }

/* --- CARDS DE CANDIDATOS --- */
.lista-candidatos { max-height: 550px; overflow-y: auto; padding-right: 5px; display: flex; flex-direction: column; gap: 12px; }
.lista-candidatos::-webkit-scrollbar { width: 6px; }
.lista-candidatos::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

.card {
  background: #f8fafc;
  border-radius: 12px;
  padding: 15px;
  border: 1px solid #e2e8f0;
  position: relative;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.card:hover { border-color: var(--azul); transform: scale(1.02); }

/* Estilo L√≠der */
.card.lider {
  background: linear-gradient(to right, #ffffff, #f0fdf4);
  border: 1px solid var(--verde);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
}
.card.lider .pct-bar-fill { background: var(--verde); }

/* Estilo Eleito */
.card.eleito {
  background: linear-gradient(to right, #fffbeb, #fef3c7);
  border: 2px solid var(--ouro);
}
.card.eleito::before {
  content: "ELEITO";
  position: absolute;
  top: -10px;
  right: 15px;
  background: var(--ouro);
  color: #78350f;
  font-size: 0.7rem;
  font-weight: 800;
  padding: 2px 8px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  z-index: 2;
}

.card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.nome-cand { font-weight: 700; font-size: 1.05rem; color: var(--texto-principal); }
.num-cand { background: var(--texto-principal); color: white; padding: 2px 8px; border-radius: 6px; font-weight: 700; font-size: 0.85rem; }

.card-stats { display: flex; justify-content: space-between; font-size: 0.9rem; font-weight: 600; margin-top: 8px; }
.votos-num { color: var(--texto-secundario); display: flex; align-items: center; gap: 5px; }
.pct-num { color: var(--texto-principal); font-size: 1.1rem; }

.pct-bar-bg { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
.pct-bar-fill { height: 100%; background: var(--azul); border-radius: 4px; transition: width 0.8s ease; width: 0%; }

/* --- MODAL --- */
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 100; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; }
.modal.active { display: flex; opacity: 1; }
.modal-content { background: white; width: 90%; max-width: 500px; padding: 30px; border-radius: 20px; position: relative; transform: scale(0.9); transition: transform 0.3s; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
.modal.active .modal-content { transform: scale(1); }
.close-modal { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; background: none; border: none; cursor: pointer; color: var(--texto-secundario); }

/* --- NOTIFICA√á√ÉO DE REVIRAVOLTA --- */
.notificacao-reviravolta {
  position: fixed;
  top: 100px;
  right: -400px; /* Escondido */
  background: white;
  width: 350px;
  border-left: 6px solid var(--vermelho);
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  z-index: 9999;
  display: flex;
  align-items: flex-start;
  gap: 15px;
  transition: right 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}

.notificacao-reviravolta.show { right: 20px; }
.not-icon { font-size: 1.8rem; color: var(--vermelho); }
.not-content h4 { color: var(--vermelho); font-weight: 800; margin-bottom: 5px; text-transform: uppercase; font-size: 0.9rem; }
.not-content p { font-size: 0.9rem; color: var(--texto-principal); line-height: 1.4; }

/* --- ANIMA√á√ïES DE REVIRAVOLTA --- */
@keyframes tenso { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
@keyframes piscarTela { 0%, 100% { opacity: 0; } 50% { opacity: 0.2; } }
@keyframes pulseLider { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }

.overlay-flash { position: fixed; inset: 0; pointer-events: none; z-index: 9998; opacity: 0; }

/* Footer */
footer { text-align: center; color: var(--texto-secundario); padding: 40px 0; font-size: 0.9rem; margin-top: auto; }

/* Responsivo */
@media (max-width: 768px) {
  .header-content { justify-content: center; text-align: center; }
  .status-bar { flex-direction: column; text-align: center; gap: 20px; }
  .stats-grid { width: 100%; justify-content: space-around; }
  .main-grid { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<div id="flashOverlay" class="overlay-flash"></div>

<header>
  <div class="container header-content">
    <div class="logo">
      <i class="fas fa-vote-yea"></i>
      <div>
        <h1>Apura√ß√£o 2026</h1>
        <p>Tribunal Eleitoral Municipal</p>
      </div>
    </div>
    <div class="header-controls">
      <button class="btn btn-glass" id="btnPause">
        <i class="fas fa-pause"></i> <span>Pausar</span>
      </button>
      <button class="btn btn-glass" id="btnInfo">
        <i class="fas fa-info-circle"></i> Info
      </button>
      <button class="btn btn-danger" id="btnReviravolta">
        <i class="fas fa-bolt"></i> Reviravolta!
      </button>
    </div>
  </div>
</header>

<div class="container">
  <div class="status-bar">
    <div class="status-left">
      <div class="badge-status">
        <div class="dot"></div>
        <span id="statusText">EM ANDAMENTO</span>
      </div>
      <div class="sessao-info" id="sessaoInfo">Sess√£o 1 de 50 apurada</div>
    </div>

    <div class="countdown-box" id="countdownBox">
      <div class="countdown-label">Atualizando em</div>
      <div class="countdown-number" id="countdown">5</div>
    </div>

    <div class="stats-grid">
      <div class="stat-item">
        <h3 id="totalUrnas">0%</h3>
        <p>Urnas</p>
      </div>
      <div class="stat-item">
        <h3 id="totalVotos">0</h3>
        <p>Votos</p>
      </div>
      <div class="stat-item">
        <h3 id="horaAtual">--:--</h3>
        <p>Hor√°rio</p>
      </div>
    </div>
  </div>

  <div class="main-grid">
    <div class="painel" id="painelPref">
      <div class="painel-header">
        <h2><i class="fas fa-landmark"></i> PREFEITO</h2>
        <span class="painel-tag">1 Vaga</span>
      </div>
      
      <div class="progress-area">
        <div class="progress-labels">
          <span>Apura√ß√£o</span>
          <span id="progressoPrefTxt">0%</span>
        </div>
        <div class="bar-bg">
          <div class="bar-fill" id="barPref"></div>
        </div>
      </div>
      
      <div class="lista-candidatos" id="cardsPref">
        </div>
    </div>

    <div class="painel" id="painelVer">
      <div class="painel-header">
        <h2><i class="fas fa-users"></i> VEREADOR</h2>
        <span class="painel-tag">5 Vagas</span>
      </div>
      
      <div class="progress-area">
        <div class="progress-labels">
          <span>Apura√ß√£o</span>
          <span id="progressoVerTxt">0%</span>
        </div>
        <div class="bar-bg">
          <div class="bar-fill" id="barVer"></div>
        </div>
      </div>
      
      <div class="lista-candidatos" id="cardsVer">
        </div>
    </div>
  </div>
</div>

<footer>
  <p><i class="fas fa-shield-alt"></i> Sistema de Simula√ß√£o Eleitoral Segura ‚Ä¢ Atualizado em <span id="lastUpdate">--:--:--</span></p>
  <p style="opacity: 0.6; font-size: 0.8rem; margin-top: 5px;">Dados fict√≠cios para fins de demonstra√ß√£o.</p>
</footer>

<div class="modal" id="infoModal">
  <div class="modal-content">
    <button class="close-modal">&times;</button>
    <h2 style="color: var(--azul); margin-bottom: 15px;">Sobre a Apura√ß√£o</h2>
    <p style="line-height: 1.6; color: var(--texto-secundario);">
      Este sistema simula uma apura√ß√£o em tempo real com 50 se√ß√µes eleitorais. 
      O sistema inclui "Reviravoltas" (Twists) que alteram a din√¢mica dos votos baseada em regi√µes geogr√°ficas e eventos aleat√≥rios.
    </p>
    <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
    <p><strong>Cargos:</strong> Prefeito (Majorit√°rio) e Vereadores (Proporcional).</p>
  </div>
</div>

<div class="notificacao-reviravolta" id="notificacao">
  <div class="not-icon"><i class="fas fa-exclamation-triangle"></i></div>
  <div class="not-content">
    <h4 id="notTitle">T√≠tulo</h4>
    <p id="notMsg">Mensagem</p>
  </div>
</div>

<script>
/* =========================================
   DADOS E CONFIGURA√á√ïES
   ========================================= */
const TOTAL_SESSOES = 50;
let sessaoAtual = 0;
let countdown = 5;
let apuracaoAtiva = true;
let intervalId = null;

// Configura√ß√£o de Reviravoltas
let reviravoltaAtiva = false;
let candidatoSurpresa = null;
const momentosDramaticos = [10, 20, 30, 40, 48]; // Sess√µes gatilho

const prefeitos = [
  {nome: "Rodrigo Manga", numero: 28, votos: 4000},
  {nome: "Ryan Everton", numero: 22, votos: 1684},
  {nome: "Arthur Silva", numero: 17, votos: 632},
  {nome: "Gabriel Arraes", numero: 77, votos: 491},
  {nome: "Javier Mendonza", numero: 35, votos: 421},
  {nome: "Noah D.", numero: 10, votos: 351},
  {nome: "Henrique Martins", numero: 15, votos: 210},
  {nome: "Fernando Hauss", numero: 43, votos: 211}
];

const vereadores = [
  {nome: "Arthur Albuquerque", numero: 38038, votos: 1924},
  {nome: "Nicollas Camargo", numero: 77400, votos: 1519},
  {nome: "Vitor Henrique", numero: 22222, votos: 1215},
  {nome: "Marcos Fernandes", numero: 50555, votos: 810},
  {nome: "Henry Farias", numero: 77778, votos: 709},
  {nome: "Lucas Junior", numero: 27000, votos: 608},
  {nome: "Michael Nonato", numero: 45555, votos: 506},
  {nome: "Thaise Gomes", numero: 11111, votos: 405},
  {nome: "Renato Santos", numero: 17000, votos: 304}
];

// Matriz de pesos (Zona Sul, Norte, Leste, Oeste - simulada)
// 0: Favorito Inicial, 1: Oposi√ß√£o
const pesos = Array.from({length: TOTAL_SESSOES}, (_, i) => {
  if (i < 10) return [0.3, 0.7];   // Zona A (ruim para favorito)
  if (i < 25) return [0.85, 0.15]; // Zona B (√≥tima para favorito)
  if (i < 40) return [0.4, 0.6];   // Zona C (disputada)
  return [0.6, 0.4];               // Zona D
});

/* =========================================
   L√ìGICA PRINCIPAL
   ========================================= */
function init() {
  updateTime();
  setInterval(updateTime, 1000);
  // Primeira renderiza√ß√£o zerada
  updateDisplay(); 
  startCountdown();
  
  // Event Listeners
  document.getElementById('btnPause').addEventListener('click', togglePause);
  document.getElementById('btnInfo').addEventListener('click', () => toggleModal(true));
  document.querySelector('.close-modal').addEventListener('click', () => toggleModal(false));
  document.getElementById('btnReviravolta').addEventListener('click', forcarReviravolta);
}

function updateTime() {
  const now = new Date();
  const timeString = now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
  const fullTime = now.toLocaleTimeString('pt-BR');
  document.getElementById('horaAtual').textContent = timeString;
  document.getElementById('lastUpdate').textContent = fullTime;
}

function startCountdown() {
  clearInterval(intervalId);
  intervalId = setInterval(() => {
    if (!apuracaoAtiva) return;

    countdown--;
    const countEl = document.getElementById('countdown');
    const countBox = document.getElementById('countdownBox');
    
    countEl.textContent = countdown;

    // Verificar drama nos √∫ltimos segundos
    if (countdown <= 3) {
      countBox.classList.add('tenso');
      countEl.style.color = 'var(--vermelho)';
    } else {
      countBox.classList.remove('tenso');
      countEl.style.color = 'var(--azul)';
    }

    // Checar reviravolta antes da atualiza√ß√£o
    verificarReviravolta();

    if (countdown === 0) {
      if (sessaoAtual < TOTAL_SESSOES) {
        sessaoAtual++;
        updateDisplay();
      } else {
        finalizarApuracao();
      }
      countdown = 5;
    }
  }, 1000);
}

function updateDisplay() {
  const pctTotal = (sessaoAtual / TOTAL_SESSOES);
  
  // Atualiza infos do header
  document.getElementById('sessaoInfo').textContent = `Sess√£o ${sessaoAtual} de ${TOTAL_SESSOES} apurada`;
  document.getElementById('totalUrnas').textContent = `${Math.round(pctTotal * 100)}%`;
  
  // Atualiza Paineis
  atualizarPainel(prefeitos, "cardsPref", "barPref", "painelPref", "progressoPrefTxt", "prefeito");
  atualizarPainel(vereadores, "cardsVer", "barVer", "painelVer", "progressoVerTxt", "vereador");

  // Total Geral de Votos (Soma simples simulada)
  const totalVotos = Math.floor(6802 * pctTotal * (1 + Math.random() * 0.1)); 
  document.getElementById('totalVotos').textContent = totalVotos.toLocaleString();

  if(sessaoAtual === TOTAL_SESSOES) finalizarApuracao();
}

function calcularVotosSimulados(candidato, index) {
  if (sessaoAtual === 0) return 0;
  
  // L√≥gica baseada nos pesos das sess√µes que j√° passaram
  let pesoAcumulado = 0;
  for(let i=0; i<sessaoAtual; i++) {
    // Se for um dos 2 primeiros, usa peso espec√≠fico, sen√£o usa um gen√©rico random
    let p = (index < 2) ? pesos[i][index] : (Math.random() * 0.5); 
    
    // Fator Candidato Surpresa
    if (candidatoSurpresa && candidato.nome === candidatoSurpresa.nome) {
      p *= 3.5; // Boost gigante
    }
    
    pesoAcumulado += p;
  }
  
  // Voto base * (progresso + variancia regional)
  let baseCalculo = (candidato.votos / TOTAL_SESSOES) * sessaoAtual;
  // Aplica o peso regional simulado
  let variacaoRegional = 1 + ((pesoAcumulado / sessaoAtual) - 0.5); 
  
  return Math.floor(baseCalculo * variacaoRegional);
}

function atualizarPainel(lista, idCards, idBar, idPainel, idTxt, cargo) {
  // 1. Calcular Votos Atuais
  const candidatosAtualizados = lista.map((c, i) => {
    return { ...c, votosAtuais: calcularVotosSimulados(c, i) };
  });

  // 2. Ordenar
  candidatosAtualizados.sort((a, b) => b.votosAtuais - a.votosAtuais);

  const totalVotosPainel = candidatosAtualizados.reduce((acc, c) => acc + c.votosAtuais, 0);
  const progressoPct = (sessaoAtual/TOTAL_SESSOES)*100;

  // 3. Renderizar Barra Topo
  document.getElementById(idBar).style.width = `${progressoPct}%`;
  document.getElementById(idTxt).textContent = `${progressoPct.toFixed(0)}%`;

  // 4. Flash Effect no Painel
  const painel = document.getElementById(idPainel);
  painel.classList.remove('flash');
  void painel.offsetWidth; // trigger reflow
  painel.classList.add('flash');

  // 5. Renderizar Cards
  const container = document.getElementById(idCards);
  let html = '';
  
  const numEleitos = (cargo === 'vereador') ? 5 : 1;
  const maiorVoto = candidatosAtualizados[0].votosAtuais;

  candidatosAtualizados.forEach((c, i) => {
    const pct = totalVotosPainel > 0 ? (c.votosAtuais / totalVotosPainel * 100) : 0;
    const isLider = (c.votosAtuais === maiorVoto && c.votosAtuais > 0);
    const isEleito = (sessaoAtual === TOTAL_SESSOES && i < numEleitos);
    
    let classes = 'card';
    if(isLider) classes += ' lider';
    if(isEleito) classes += ' eleito';

    // Se for o candidato surpresa, destaque extra
    if(candidatoSurpresa && c.nome === candidatoSurpresa.nome) {
      classes += ' flash'; // Reusa anima√ß√£o flash
    }

    html += `
      <div class="${classes}">
        <div class="card-top">
          <span class="nome-cand">${c.nome}</span>
          <span class="num-cand">${c.numero}</span>
        </div>
        <div class="pct-bar-bg">
          <div class="pct-bar-fill" style="width: ${pct}%"></div>
        </div>
        <div class="card-stats">
          <span class="votos-num"><i class="fas fa-check"></i> ${c.votosAtuais.toLocaleString()}</span>
          <span class="pct-num">${pct.toFixed(2)}%</span>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function finalizarApuracao() {
  apuracaoAtiva = false;
  clearInterval(intervalId);
  document.getElementById('statusText').textContent = "APURA√á√ÉO ENCERRADA";
  document.querySelector('.dot').style.background = "var(--vermelho)";
  document.querySelector('.dot').style.animation = "none";
  document.getElementById('countdownBox').style.display = 'none';
  
  mostrarNotificacao("FIM DA APURA√á√ÉO", "Os resultados apresentados s√£o oficiais.");
}

/* =========================================
   SISTEMA DE REVIRAVOLTAS (TWISTS)
   ========================================= */
function verificarReviravolta() {
  if (!apuracaoAtiva) return;
  
  if (momentosDramaticos.includes(sessaoAtual) && !reviravoltaAtiva) {
    executarReviravoltaAleatoria();
  }
}

function forcarReviravolta() {
  if(sessaoAtual >= TOTAL_SESSOES) return alert("Apura√ß√£o j√° encerrada!");
  executarReviravoltaAleatoria();
}

function executarReviravoltaAleatoria() {
  reviravoltaAtiva = true;
  const tipos = ['inversao', 'surpresa', 'urna', 'rejeicao'];
  const tipo = tipos[Math.floor(Math.random() * tipos.length)];
  
  switch(tipo) {
    case 'inversao': inversaoLideranca(); break;
    case 'surpresa': candidatoSurpresaEmergente(); break;
    case 'urna': problemaUrna(); break;
    case 'rejeicao': votosInvalidos(); break;
  }

  // Reset flag ap√≥s um tempo
  setTimeout(() => { reviravoltaAtiva = false; candidatoSurpresa = null; }, 15000);
}

function inversaoLideranca() {
  mostrarNotificacao("‚ö†Ô∏è MUDAN√áA DE CEN√ÅRIO", "Urnas da Zona Rural chegaram! Tend√™ncia de votos invertida drasticamente.");
  piscarTela('#fbbf24', 3);
  
  // Inverte os pesos das pr√≥ximas 5 sess√µes
  for(let i=0; i<5; i++) {
    if(sessaoAtual + i < TOTAL_SESSOES) {
      pesos[sessaoAtual+i] = [0.1, 0.9]; // Favorece brutalmente o segundo colocado
    }
  }
}

function candidatoSurpresaEmergente() {
  // Pega algu√©m do meio da tabela de prefeitos
  candidatoSurpresa = prefeitos[Math.floor(Math.random() * (prefeitos.length - 2)) + 2];
  
  mostrarNotificacao("üö® FEN√îMENO NAS URNAS", `${candidatoSurpresa.nome} est√° surpreendendo com vota√ß√£o massiva nesta regi√£o!`);
  piscarTela('#ef4444', 4);
}

function problemaUrna() {
  mostrarNotificacao("‚è≥ PROBLEMA T√âCNICO", "Urna com defeito na Se√ß√£o 104. A contagem est√° temporariamente lenta.");
  piscarTela('#3b82f6', 2);
  
  // Atrasa o contador visualmente
  const el = document.getElementById('countdown');
  el.textContent = "--";
  apuracaoAtiva = false;
  
  setTimeout(() => {
    apuracaoAtiva = true;
    startCountdown(); // Retoma
  }, 4000);
}

function votosInvalidos() {
  mostrarNotificacao("‚ùå ALTA REJEI√á√ÉO", "Esta zona eleitoral apresenta √≠ndice recorde de votos Nulos/Brancos!");
  piscarTela('#9ca3af', 2);
  
  // Efeito visual: barras ficam cinzas por um momento
  document.querySelectorAll('.pct-bar-fill').forEach(bar => {
    bar.style.backgroundColor = '#9ca3af';
  });
  
  setTimeout(() => {
    document.querySelectorAll('.pct-bar-fill').forEach(bar => {
      bar.style.backgroundColor = ''; // Volta ao CSS original
    });
  }, 3000);
}

/* =========================================
   UI HELPERS
   ========================================= */
function mostrarNotificacao(titulo, msg) {
  const notif = document.getElementById('notificacao');
  document.getElementById('notTitle').textContent = titulo;
  document.getElementById('notMsg').textContent = msg;
  
  notif.classList.add('show');
  
  // Som de notifica√ß√£o (simulado visualmente com vibra√ß√£o)
  if(navigator.vibrate) navigator.vibrate([200, 100, 200]);

  setTimeout(() => {
    notif.classList.remove('show');
  }, 6000);
}

function piscarTela(cor, vezes) {
  const overlay = document.getElementById('flashOverlay');
  overlay.style.backgroundColor = cor;
  overlay.style.animation = `piscarTela 0.3s ease-in-out ${vezes}`;
  
  setTimeout(() => {
    overlay.style.animation = 'none';
  }, vezes * 300 + 100);
}

function togglePause() {
  apuracaoAtiva = !apuracaoAtiva;
  const btn = document.getElementById('btnPause');
  const status = document.getElementById('statusText');
  
  if (apuracaoAtiva) {
    btn.innerHTML = '<i class="fas fa-pause"></i> <span>Pausar</span>';
    status.textContent = "EM ANDAMENTO";
    document.querySelector('.dot').style.animation = "pulseDot 1.5s infinite";
    document.querySelector('.dot').style.background = "var(--verde)";
    startCountdown();
  } else {
    btn.innerHTML = '<i class="fas fa-play"></i> <span>Continuar</span>';
    status.textContent = "PAUSADO";
    document.querySelector('.dot').style.animation = "none";
    document.querySelector('.dot').style.background = "var(--ouro)";
    clearInterval(intervalId);
  }
}

function toggleModal(show) {
  const modal = document.getElementById('infoModal');
  if(show) {
    modal.classList.add('active');
  } else {
    modal.classList.remove('active');
  }
}

// Iniciar
window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
